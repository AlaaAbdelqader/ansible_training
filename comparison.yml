---
 - hosts: localhost
   gather_facts: no
   become: yes 
   tasks:   
    - name: Get state First file
      stat:
       path : "{{file1}}"  
      register: myfirstfile
    - name: Get selinux  First file
      shell: "ls -Z {{file1}}"
      register: SELinux1
    - name: Get selinux  sec file
      shell: "ls -Z {{file2}}"
      register: SELinux2     
    - name: extract content1 from file
      slurp:
        src: "{{file1}}"
      register: content1  
    - name: file1_fact
      set_fact:
        permissions1: "{{ myfirstfile.stat.mode }}"
        owners1: "{{ myfirstfile.stat.pw_name }}"
        group1:  "{{myfirstfile.stat.gr_name}}"
        se1: "{{SELinux1.stdout.split()[3]}}"
        text1: "{{content1.content}}"
#####################################################################         
    - name: Get state Second File
      stat:
       path : "{{file2}}"
      register: mysecondfile
    - name: extract content from file2
      slurp:
        src: "{{file2}}"
      register: content2  
    - name: file2_fact
      set_fact:
        permissions2: "{{mysecondfile.stat.mode}}"
        owners2: "{{mysecondfile.stat.pw_name}}"
        group2:  "{{mysecondfile.stat.gr_name}}"
        se2: "{{SELinux2.stdout.split()[3]}}"
        text2: "{{content2.content}}"


    - name: Set results
      set_fact:
       permissions: "{% if permissions1 != permissions2 %}{{file1}} permission -> {{permissions1}} {{file2}} permissions -> {{permissions2}}{% endif %}"
       ownerss: "{% if owners1 != owners2 %}{{file1}} owner -> {{owners1}}  {{file2}} owner -> {{owners2}} {% endif %}" 
       groupss: "{% if group1 != group2 %}{{file1}} group -> {{group1}}  {{file2}} group -> {{group2}}{% endif %}"
       mode: "{% if se1 != se2 %}{{file1}} SELinux -> {{se1}} {{file2}} SELinux -> {{se2}}{% endif %}" 
       contents: "{% if text1 != text2 %}{{file1}} content -> {{text1}} {{file2}} content -> {{text2}}{% endif %}"  
    - debug:
        msg: 
         - "{{permissions}}"
         - "{{ownerss}}"
         - "{{groupss}}"
         - "{{mode}}"
         - "{{contents}}"

                   
        # ansible-playbook comparison.yml -e "file1=/tmp/backup/192.168.204.235/home/ansadmin/alaa file2=/tmp/task1/192.168.204.235/home/ansadmin/alaa"

             
